# DetailScribe


This is an implementation of DetailScribe in the paper [Generating Fine Details of Entity Interactions]:


DetailScribe achieves fine-grained image generation by decomposition-augmented refinement procedure. This repo contains:

* ü¶î A simple Diffusers-empowered implementation of **DetailScribe**.
* üìö 1000 prompts in **InterActing**, an interaction-focused dataset with 1000 fine-grained prompts.
* üë©üèª‚Äçüî¨ Human rated images generated by DetailScribe and baselines, for 50 selected prompts.

## Preparation

### Installation

Download the code:
```
git clone https://github.com/gxy000/DetailScribe.git
cd DetailScribe
```

All the dependencies for **DetailScribe** can be installed in a [conda](https://conda.io/) environment using:

```
pip install -r requirements.txt
```
## Dataset

### InterActing
Prompts in **InterActing** is available in:

```
InterActing/data/original_prompt
```
### Human Evaluation
Download the generated images and the corresponding human evaluations from [Dropbox](https://www.dropbox.com/scl/fo/wepr3j5kg6fthvj2d8kq9/APysjf2xwRUYWxDG9hyoekw?rlkey=9esh8btznjy6nby0pzbinsxzx&st=f3275099&dl=0).

## Usage

### Inference
Example scripts for running **DetailScribe** for a list of original prompt of jsonl format.

To generate the decomposed components for each original prompt:
```
python InterActing/prompt_completion.py --data_dir InterActing/data \
--scenario toy_data_001 --type decomposition
```

To generate the images for each original prompt:
`experiment_names` can be `DetailScirbe`, and the baselines including: `init_only` (for vanilla SD3.5 and SD + multi-seed), `gpt_rewrite` (SD + GPT Rewrite), `gpt_refine` (SD + GPT refine) and `dalle3`
```
python DetailScribe/DetailScribe.py \
--prompt_path InterActing/data/decomposition/toy_data_001.jsonl \
--seed 2628670643 \
--experiment_name DetailScribe
```

### Evaluation

To evaluate the generated images:
`metric` can be `ImageReward`, `CLIPScore`, `BLIP-VQA` and `gpt` (don't forget to export the OpenAI API key as `OPENAI_API_KEY` in your local environment)
```
data_name="toy_data_001"

python DetailScribe/results_cleanup_and_preprocess.py \
--new_prompt_path "results/${data_name}/new_prompt_2628670643_detailscribe.jsonl" \
--primary_seed 2628670643 --multi_seed 2628670647

python DetailScribe/auto_evaluators.py \
"results/eval/dict/main_${data_name}.jsonl" \
--metric gpt \
--by_scale
```

## Acknowledgements


## Contact

If you have any questions, feel free to contact me through email (gxy@mit.edu). Enjoy!
